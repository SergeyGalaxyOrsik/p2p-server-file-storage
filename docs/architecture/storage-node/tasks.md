# Задачи для реализации Storage Node

## Общая информация

Этот документ содержит детальный список задач для реализации Storage Node с разделением на ядро и платформо-зависимые обработчики.

**Оценка времени:** ~2 недели (80 часов)

---

## Этап 1: Платформо-зависимые интерфейсы и обработчики

### Задача 1.1: Настройка проекта
**Приоритет:** Высокий  
**Время:** 2 часа  
**Статус:** ⬜ Не начато

- [x] Создать структуру папок:
  - [x] `storage-node/src/core/`
  - [x] `storage-node/src/platform/interfaces/`
  - [x] `storage-node/src/platform/windows/`
  - [x] `storage-node/src/platform/linux/`
  - [x] `storage-node/include/core/`
  - [x] `storage-node/include/platform/`
- [x] Создать `CMakeLists.txt` с поддержкой Windows и Linux
- [x] Настроить условную компиляцию для разных платформ
- [x] Настроить зависимости (common library)

**Критерии приёмки:**
- Проект компилируется для Windows и Linux
- Структура папок соответствует архитектуре

---

### Задача 1.2: Реализация интерфейса IFileHandler
**Приоритет:** Высокий  
**Время:** 2 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/interfaces/ifile_handler.h`

**Функциональность:**
- [x] Определить интерфейс `IFileHandler`
- [x] Методы: `FileExists`, `ReadFile`, `WriteFile`, `DeleteFile`
- [x] Методы: `GetFileSize`, `GetFileInfo`
- [x] Методы: `CreateDirectory`, `DirectoryExists`
- [x] Структура `FileInfo`
- [x] Виртуальный деструктор

**Критерии приёмки:**
- Интерфейс определён корректно
- Все методы чисто виртуальные
- Структура FileInfo содержит необходимые поля

---

### Задача 1.3: Реализация интерфейса IDiskHandler
**Приоритет:** Высокий  
**Время:** 1 час  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/interfaces/idisk_handler.h`

**Функциональность:**
- [x] Определить интерфейс `IDiskHandler`
- [x] Методы: `GetFreeSpace`, `GetTotalSpace`, `GetUsedSpace`
- [x] Метод: `IsPathValid`
- [x] Виртуальный деструктор

**Критерии приёмки:**
- Интерфейс определён корректно
- Все методы чисто виртуальные

---

### Задача 1.4: Реализация интерфейса IPathHandler
**Приоритет:** Высокий  
**Время:** 1 час  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/interfaces/ipath_handler.h`

**Функциональность:**
- [x] Определить интерфейс `IPathHandler`
- [x] Методы: `Join`, `GetDirectory`, `GetFilename`, `GetExtension`
- [x] Методы: `Normalize`, `Absolute`
- [x] Методы: `GetSeparator`, `GetSeparatorString`
- [x] Виртуальный деструктор

**Критерии приёмки:**
- Интерфейс определён корректно
- Все методы чисто виртуальные

---

### Задача 1.5: Реализация WindowsFileHandler
**Приоритет:** Высокий  
**Время:** 4 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/windows/windows_file_handler.h`
- `storage-node/src/platform/windows/windows_file_handler.cpp`

**Функциональность:**
- [x] Реализовать все методы `IFileHandler`
- [x] `FileExists` - через `GetFileAttributesA`
- [x] `ReadFile` - через `CreateFile`, `ReadFile`, `GetFileSizeEx`
- [x] `WriteFile` - через `CreateFile`, `WriteFile`
- [x] `DeleteFile` - через `DeleteFileA`
- [x] `GetFileSize` - через `GetFileSizeEx`
- [x] `GetFileInfo` - через `GetFileAttributesEx`
- [x] `CreateDirectory` - через `CreateDirectoryA`
- [x] `DirectoryExists` - через `GetFileAttributesA`
- [x] Обработка ошибок WinAPI
- [x] Правильное закрытие HANDLE

**Критерии приёмки:**
- Все методы работают корректно
- Обработка ошибок WinAPI
- Нет утечек HANDLE
- Тесты для основных операций

---

### Задача 1.6: Реализация WindowsDiskHandler
**Приоритет:** Высокий  
**Время:** 2 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/windows/windows_disk_handler.h`
- `storage-node/src/platform/windows/windows_disk_handler.cpp`

**Функциональность:**
- [ ] Реализовать все методы `IDiskHandler`
- [ ] `GetFreeSpace` - через `GetDiskFreeSpaceExA`
- [ ] `GetTotalSpace` - через `GetDiskFreeSpaceExA`
- [ ] `GetUsedSpace` - вычисление из total и free
- [ ] `IsPathValid` - через `GetFileAttributesA`
- [ ] Обработка ошибок

**Критерии приёмки:**
- Все методы работают корректно
- Корректная обработка больших значений (uint64_t)
- Тесты для основных операций

---

### Задача 1.7: Реализация WindowsPathHandler
**Приоритет:** Высокий  
**Время:** 2 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/windows/windows_path_handler.h`
- `storage-node/src/platform/windows/windows_path_handler.cpp`

**Функциональность:**
- [ ] Реализовать все методы `IPathHandler`
- [ ] `Join` - объединение путей с `\`
- [ ] `GetDirectory` - извлечение директории
- [ ] `GetFilename` - извлечение имени файла
- [ ] `GetExtension` - извлечение расширения
- [ ] `Normalize` - нормализация пути
- [ ] `Absolute` - через `GetFullPathNameA`
- [ ] `GetSeparator` - возврат `\`

**Критерии приёмки:**
- Все методы работают корректно
- Обработка граничных случаев (пустые пути, корневые пути)
- Тесты для основных операций

---

### Задача 1.8: Реализация LinuxFileHandler
**Приоритет:** Высокий  
**Время:** 4 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/linux/linux_file_handler.h`
- `storage-node/src/platform/linux/linux_file_handler.cpp`

**Функциональность:**
- [ ] Реализовать все методы `IFileHandler`
- [ ] `FileExists` - через `stat` и `S_ISREG`
- [ ] `ReadFile` - через `std::ifstream` или POSIX API
- [ ] `WriteFile` - через `std::ofstream` или POSIX API
- [ ] `DeleteFile` - через `unlink`
- [ ] `GetFileSize` - через `stat`
- [ ] `GetFileInfo` - через `stat`
- [ ] `CreateDirectory` - через `mkdir`
- [ ] `DirectoryExists` - через `stat` и `S_ISDIR`
- [ ] Обработка ошибок (errno)
- [ ] Правильные права доступа (0755)

**Критерии приёмки:**
- Все методы работают корректно
- Обработка ошибок errno
- Тесты для основных операций

---

### Задача 1.9: Реализация LinuxDiskHandler
**Приоритет:** Высокий  
**Время:** 2 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/linux/linux_disk_handler.h`
- `storage-node/src/platform/linux/linux_disk_handler.cpp`

**Функциональность:**
- [ ] Реализовать все методы `IDiskHandler`
- [ ] `GetFreeSpace` - через `statvfs`
- [ ] `GetTotalSpace` - через `statvfs`
- [ ] `GetUsedSpace` - вычисление из total и free
- [ ] `IsPathValid` - через `stat`
- [ ] Обработка ошибок

**Критерии приёмки:**
- Все методы работают корректно
- Корректная обработка больших значений
- Тесты для основных операций

---

### Задача 1.10: Реализация LinuxPathHandler
**Приоритет:** Высокий  
**Время:** 2 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/linux/linux_path_handler.h`
- `storage-node/src/platform/linux/linux_path_handler.cpp`

**Функциональность:**
- [ ] Реализовать все методы `IPathHandler`
- [ ] `Join` - объединение путей с `/`
- [ ] `GetDirectory` - извлечение директории
- [ ] `GetFilename` - извлечение имени файла
- [ ] `GetExtension` - извлечение расширения
- [ ] `Normalize` - нормализация пути
- [ ] `Absolute` - через `realpath`
- [ ] `GetSeparator` - возврат `/`

**Критерии приёмки:**
- Все методы работают корректно
- Обработка граничных случаев
- Тесты для основных операций

---

### Задача 1.11: Реализация PlatformHandlerFactory
**Приоритет:** Высокий  
**Время:** 2 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/platform/factory.h`
- `storage-node/src/platform/factory.cpp`

**Функциональность:**
- [ ] Метод `CreateFileHandler()` - условная компиляция
- [ ] Метод `CreateDiskHandler()` - условная компиляция
- [ ] Метод `CreatePathHandler()` - условная компиляция
- [ ] Использование `#ifdef _WIN32` и `#ifdef __linux__`
- [ ] Обработка неподдерживаемых платформ

**Критерии приёмки:**
- Фабрика создаёт правильные обработчики для каждой платформы
- Компиляция работает для Windows и Linux

---

## Этап 2: Ядро (Core)

### Задача 2.1: Реализация ChunkStorage (часть 1 - базовая функциональность)
**Приоритет:** Высокий  
**Время:** 6 часов  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/core/chunk_storage.h`
- `storage-node/src/core/chunk_storage.cpp`

**Функциональность:**
- [ ] Конструктор с инъекцией зависимостей
- [ ] `Initialize(path)` - инициализация хранилища
  - [ ] Сохранение пути
  - [ ] Создание директории если не существует
  - [ ] Сканирование существующих чанков (опционально)
- [ ] `StoreChunk(chunkId, data)` - сохранение чанка
  - [ ] Валидация chunkId
  - [ ] Проверка свободного места
  - [ ] Получение пути через IPathHandler
  - [ ] Сохранение через IFileHandler
  - [ ] Обновление кэша
- [ ] `GetChunk(chunkId, data)` - получение чанка
  - [ ] Валидация chunkId
  - [ ] Получение пути
  - [ ] Чтение через IFileHandler
- [ ] Потокобезопасность (мьютекс)

**Критерии приёмки:**
- Сохранение и чтение чанков работает
- Используются платформо-зависимые обработчики
- Потокобезопасность обеспечена

---

### Задача 2.2: Реализация ChunkStorage (часть 2 - дополнительные методы)
**Приоритет:** Высокий  
**Время:** 3 часа  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] `DeleteChunk(chunkId)` - удаление чанка
  - [ ] Валидация chunkId
  - [ ] Удаление через IFileHandler
  - [ ] Удаление из кэша
- [ ] `ChunkExists(chunkId)` - проверка существования
- [ ] `GetTotalSize()` - общий размер всех чанков
- [ ] `GetFreeSpace()` - свободное место через IDiskHandler
- [ ] `GetChunkCount()` - количество чанков
- [ ] `ListChunks()` - список всех chunkId
- [ ] `ValidateChunkId(chunkId)` - валидация формата SHA-256

**Критерии приёмки:**
- Все методы работают корректно
- Используются платформо-зависимые обработчики

---

### Задача 2.3: Реализация MetadataClient
**Приоритет:** Высокий  
**Время:** 4 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/core/metadata_client.h`
- `storage-node/src/core/metadata_client.cpp`

**Функциональность:**
- [ ] Конструктор
- [ ] `RegisterNode(localIp, localPort, freeSpace, nodeId)` - регистрация
  - [ ] Подключение к Metadata Server
  - [ ] Формирование запроса REGISTER_NODE
  - [ ] Отправка запроса
  - [ ] Получение ответа
  - [ ] Парсинг ответа (REGISTER_RESPONSE OK <node_id>)
  - [ ] Сохранение nodeId
- [ ] `SendKeepAlive(nodeId)` - отправка keep-alive
  - [ ] Подключение к серверу
  - [ ] Формирование запроса KEEP_ALIVE
  - [ ] Отправка и получение ответа
- [ ] `UpdateFreeSpace(nodeId, freeSpace)` - обновление места
  - [ ] Подключение к серверу
  - [ ] Формирование запроса UPDATE_SPACE
  - [ ] Отправка и получение ответа
- [ ] Использование NetworkUtils из common

**Критерии приёмки:**
- Регистрация работает корректно
- Keep-alive отправляется
- Обработка ошибок сети

---

### Задача 2.4: Реализация ProtocolHandler (часть 1 - базовые команды)
**Приоритет:** Высокий  
**Время:** 4 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/core/protocol_handler.h`
- `storage-node/src/core/protocol_handler.cpp`

**Функциональность:**
- [ ] Конструктор с указателем на ChunkStorage
- [ ] `ProcessRequest(request, socket)` - главный метод
  - [ ] Парсинг команды
  - [ ] Маршрутизация к обработчику
- [ ] `HandleCheckChunk(args)` - обработка CHECK_CHUNK
  - [ ] Парсинг chunkId
  - [ ] Проверка существования
  - [ ] Формирование ответа (CHECK_RESPONSE EXISTS/NOT_FOUND)
- [ ] `HandleDeleteChunk(args)` - обработка DELETE_CHUNK
  - [ ] Парсинг chunkId
  - [ ] Удаление чанка
  - [ ] Формирование ответа
- [ ] Утилиты: `ParseCommand`, `CreateErrorResponse`

**Критерии приёмки:**
- Команды обрабатываются корректно
- Ответы соответствуют протоколу

---

### Задача 2.5: Реализация ProtocolHandler (часть 2 - работа с данными)
**Приоритет:** Высокий  
**Время:** 6 часов  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] `HandleStoreChunk(args, socket)` - обработка STORE_CHUNK
  - [ ] Парсинг chunkId и size
  - [ ] Валидация chunkId (64 символа hex)
  - [ ] Получение бинарных данных из сокета
  - [ ] Сохранение через ChunkStorage
  - [ ] Формирование ответа (STORE_RESPONSE OK/ERROR)
- [ ] `HandleGetChunk(args, socket)` - обработка GET_CHUNK
  - [ ] Парсинг chunkId
  - [ ] Получение чанка через ChunkStorage
  - [ ] Отправка ответа (GET_RESPONSE OK <size>)
  - [ ] Отправка бинарных данных
- [ ] `ReceiveBinaryData(socket, data, size)` - получение бинарных данных
- [ ] `SendBinaryData(socket, data)` - отправка бинарных данных
- [ ] Обработка ошибок передачи данных

**Критерии приёмки:**
- Сохранение и получение чанков работает
- Бинарные данные передаются корректно
- Обработка ошибок

---

### Задача 2.6: Реализация StorageNode (часть 1 - инициализация)
**Приоритет:** Высокий  
**Время:** 4 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/include/core/node.h`
- `storage-node/src/core/node.cpp`

**Функциональность:**
- [ ] Конструктор с параметрами
- [ ] Деструктор с очисткой
- [ ] `Initialize()` - инициализация узла
  - [ ] Создание платформо-зависимых обработчиков через Factory
  - [ ] Создание ChunkStorage с обработчиками
  - [ ] Инициализация ChunkStorage
  - [ ] Инициализация сетевого слоя
  - [ ] Создание слушающего сокета
  - [ ] Привязка к порту
  - [ ] Настройка listen()
- [ ] `InitializeNetwork()` - инициализация Winsock/сокетов
- [ ] `CreateListenSocket()` - создание сокета
- [ ] Использование NetworkUtils из common

**Критерии приёмки:**
- Узел инициализируется корректно
- Сокет создаётся и слушает порт
- Все компоненты создаются правильно

---

### Задача 2.7: Реализация StorageNode (часть 2 - регистрация и работа)
**Приоритет:** Высокий  
**Время:** 4 часа  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] `RegisterWithMetadataServer()` - регистрация на сервере
  - [ ] Получение свободного места через ChunkStorage
  - [ ] Получение локального IP-адреса
  - [ ] Вызов MetadataClient::RegisterNode
  - [ ] Сохранение nodeId
- [ ] `Run()` - основной цикл работы
  - [ ] Регистрация на Metadata Server
  - [ ] Запуск keep-alive потока
  - [ ] Цикл accept() для приёма клиентов
  - [ ] Создание потоков для обработки клиентов
- [ ] `HandleClient(socket)` - обработка клиента
  - [ ] Получение запроса
  - [ ] Обработка через ProtocolHandler
  - [ ] Отправка ответа
  - [ ] Закрытие соединения
- [ ] `GetLocalIPAddress()` - получение локального IP

**Критерии приёмки:**
- Регистрация работает
- Узел принимает соединения
- Клиенты обрабатываются

---

### Задача 2.8: Реализация StorageNode (часть 3 - keep-alive и завершение)
**Приоритет:** Высокий  
**Время:** 3 часа  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] `StartKeepAliveThread()` - запуск потока
- [ ] `StopKeepAliveThread()` - остановка потока
- [ ] `KeepAliveLoop()` - цикл keep-alive
  - [ ] Периодическая отправка (каждые 30 секунд)
  - [ ] Получение свободного места
  - [ ] Отправка KEEP_ALIVE
  - [ ] Отправка UPDATE_SPACE
  - [ ] Обработка ошибок (повторные попытки)
- [ ] `Shutdown()` - корректное завершение
  - [ ] Установка флага running = false
  - [ ] Остановка keep-alive потока
  - [ ] Закрытие слушающего сокета
  - [ ] Ожидание завершения потоков клиентов
  - [ ] Очистка ресурсов
- [ ] Обработка сигналов завершения (Ctrl+C)

**Критерии приёмки:**
- Keep-alive работает стабильно
- Корректное завершение работы
- Нет утечек ресурсов

---

### Задача 2.9: Реализация main.cpp
**Приоритет:** Высокий  
**Время:** 2 часа  
**Статус:** ⬜ Не начато

**Файлы:**
- `storage-node/src/main.cpp`

**Функциональность:**
- [ ] Парсинг аргументов командной строки:
  - [ ] `--storage-path` - путь к хранилищу
  - [ ] `--metadata-server` - IP Metadata Server
  - [ ] `--metadata-port` - порт Metadata Server
  - [ ] `--port` - порт узла (опционально, автоопределение)
- [ ] Создание экземпляра StorageNode
- [ ] Инициализация
- [ ] Регистрация на Metadata Server
- [ ] Запуск узла
- [ ] Обработка сигналов (SIGINT, SIGTERM)
- [ ] Корректное завершение

**Критерии приёмки:**
- Узел запускается из командной строки
- Параметры парсятся корректно
- Корректное завершение

---

## Этап 3: Интеграция и тестирование

### Задача 3.1: Интеграция всех компонентов
**Приоритет:** Высокий  
**Время:** 4 часа  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] Проверка работы всех компонентов вместе
- [ ] Тестирование на Windows
- [ ] Тестирование на Linux (если доступно)
- [ ] Проверка отсутствия утечек памяти
- [ ] Проверка потокобезопасности

**Критерии приёмки:**
- Все компоненты работают вместе
- Нет утечек памяти
- Корректное завершение работы

---

### Задача 3.2: Логирование
**Приоритет:** Средний  
**Время:** 3 часа  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] Система логирования (консоль или файл)
- [ ] Уровни логирования (INFO, WARNING, ERROR)
- [ ] Логирование важных событий:
  - [ ] Регистрация на Metadata Server
  - [ ] Приём клиентов
  - [ ] Сохранение/получение чанков
  - [ ] Keep-alive
  - [ ] Ошибки

**Критерии приёмки:**
- Логирование работает
- Логи информативны

---

### Задача 3.3: Обработка ошибок
**Приоритет:** Высокий  
**Время:** 3 часа  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] Обработка сетевых ошибок
- [ ] Обработка ошибок файловой системы
- [ ] Обработка ошибок протокола
- [ ] Повторные попытки при сбоях (keep-alive)
- [ ] Корректные ответы об ошибках клиентам
- [ ] Логирование всех ошибок

**Критерии приёмки:**
- Все ошибки обрабатываются
- Клиенты получают понятные сообщения
- Узел не падает при ошибках

---

### Задача 3.4: Unit-тесты для обработчиков
**Приоритет:** Средний  
**Время:** 6 часов  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] Тесты для WindowsFileHandler
  - [ ] Создание, чтение, запись, удаление файлов
  - [ ] Получение информации о файлах
- [ ] Тесты для WindowsDiskHandler
  - [ ] Получение информации о диске
- [ ] Тесты для WindowsPathHandler
  - [ ] Операции с путями
- [ ] Тесты для LinuxFileHandler (если доступно)
- [ ] Тесты для LinuxDiskHandler (если доступно)
- [ ] Тесты для LinuxPathHandler (если доступно)

**Критерии приёмки:**
- Все обработчики покрыты тестами
- Тесты проходят

---

### Задача 3.5: Unit-тесты для ядра
**Приоритет:** Средний  
**Время:** 8 часов  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] Моки для обработчиков (MockFileHandler, MockDiskHandler, MockPathHandler)
- [ ] Тесты для ChunkStorage с моками
  - [ ] Сохранение, чтение, удаление чанков
  - [ ] Валидация chunkId
  - [ ] Проверка свободного места
- [ ] Тесты для MetadataClient
  - [ ] Регистрация узла
  - [ ] Keep-alive
  - [ ] Обновление места
- [ ] Тесты для ProtocolHandler
  - [ ] Парсинг команд
  - [ ] Обработка команд
  - [ ] Формирование ответов

**Критерии приёмки:**
- Основные функции покрыты тестами
- Тесты используют моки
- Тесты проходят

---

### Задача 3.6: Интеграционное тестирование
**Приоритет:** Высокий  
**Время:** 6 часов  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] Тест полного цикла регистрации узла
- [ ] Тест сохранения чанка от клиента
- [ ] Тест получения чанка клиентом
- [ ] Тест удаления чанка
- [ ] Тест keep-alive механизма
- [ ] Тест обработки отказов (потеря связи с Metadata Server)
- [ ] Тест множественных одновременных соединений

**Критерии приёмки:**
- Все сценарии работают
- Система стабильна
- Нет утечек памяти

---

### Задача 3.7: Документация кода
**Приоритет:** Низкий  
**Время:** 3 часа  
**Статус:** ⬜ Не начато

**Функциональность:**
- [ ] Комментарии к классам и методам
- [ ] Описание параметров
- [ ] Примеры использования
- [ ] README для storage-node
- [ ] Описание архитектуры разделения на ядро и обработчики

**Критерии приёмки:**
- Код документирован
- Легко понять назначение компонентов

---

## Итоговая проверка

### Критерии готовности Storage Node:

- [ ] Узел запускается и регистрируется на Metadata Server
- [ ] Keep-alive механизм работает
- [ ] Клиенты могут сохранять чанки (STORE_CHUNK)
- [ ] Клиенты могут получать чанки (GET_CHUNK)
- [ ] Клиенты могут проверять наличие чанков (CHECK_CHUNK)
- [ ] Клиенты могут удалять чанки (DELETE_CHUNK)
- [ ] Работает на Windows
- [ ] Работает на Linux (если доступно)
- [ ] Обработка ошибок работает корректно
- [ ] Нет утечек памяти
- [ ] Корректное завершение работы

---

## Приоритизация задач

**Критический путь (необходимо для базовой работы):**
1. Задачи 1.1-1.11 (платформо-зависимые обработчики)
2. Задачи 2.1-2.9 (ядро)
3. Задача 3.1 (интеграция)

**Важные (для стабильной работы):**
- Задача 2.8 (keep-alive)
- Задача 3.3 (обработка ошибок)
- Задача 3.6 (интеграционное тестирование)

**Желательные (для улучшения):**
- Задача 3.2 (логирование)
- Задачи 3.4-3.5 (unit-тесты)
- Задача 3.7 (документация)

---

## Заметки по реализации

1. **Платформо-зависимый код:** Весь код работы с файлами и диском должен быть в обработчиках
2. **Инъекция зависимостей:** ChunkStorage получает обработчики через конструктор
3. **Фабрика:** Использовать PlatformHandlerFactory для создания обработчиков
4. **Потокобезопасность:** Все операции с shared данными защищены мьютексами
5. **Управление памятью:** Использовать умные указатели (unique_ptr)
6. **Обработка ошибок:** Все ошибки должны логироваться и обрабатываться
7. **Протокол:** Строго следовать спецификации протокола из `05-network-protocol.md`
8. **Тестирование:** Тестировать ядро с моками, обработчики отдельно

---

## Особенности реализации для разных платформ

### Windows
- Использовать WinAPI для файловых операций
- Использовать `GetDiskFreeSpaceEx` для диска
- Пути с обратными слешами (`\`)
- Обработка HANDLE (правильное закрытие)

### Linux
- Использовать POSIX API или std::fstream
- Использовать `statvfs` для диска
- Пути с прямыми слешами (`/`)
- Правильные права доступа (0755 для директорий)

